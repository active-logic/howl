language: csharp
mono: none
script: dotnet test build $TEST_ARGS
jobs:
  include:
    # Linux: run tests, export coverage report
    - os: linux
      env: TEST_ARGS="-p:CollectCoverage=true -p:CoverletOutputFormat=opencover"
      dotnet: 3.1.3
      before_script:
        - ./setup
        - ./scripts/solution
      after_script:
        - sed -i 's/.cs/.howl/g' build/test/coverage.opencover.xml
        - bash <(curl -s https://codecov.io/bash)
    # Windows: tests only, verbose output
    - os: windows
      env: TEST_ARGS="-l console;verbosity=normal"
      before_script:
        - powershell Set-ExecutionPolicy Unrestricted
        - choco install dotnetcore-sdk
        - powershell "./setup.ps1"
        - powershell howl build .
