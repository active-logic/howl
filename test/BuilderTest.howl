âŠ NUnit.Framework;
âŠ Active.Howl;

âŠ“ Unit{
â€’ â—‹ BuilderTest : TestBase{

    Builder Î²;

    âœ Setup âš Î² = âŒ¢ Builder();

    // --------------------------------------------------------------

    ØŸ Build(){ MkMain_howl(); o( Î².Build("~/Sandbox") ); }

    ØŸ Install(){
        MkMain_howl();
        â¤´ (OS.isLinux){
            // Symlink fails on Travis CI
            âˆ™ user = System.Environment.UserName;
            ğŸ° $"USER: {user}";
            o( Î².Install("~/Sandbox", addToPath: user â‰  "travis") );
        }â¤³ (OS.isWindows){
            // $profile not in environment variables (maybe CI only)
            o( Î².Install("~/Sandbox", addToPath: âœ“), âœ—);
            o( Î².Install("~/Sandbox", addToPath: âœ—), âœ“);
        }â¤µ{
            o( Î².Install("~/Sandbox", addToPath: âœ“) );
        }
    }

    ØŸ Publish(){ MkMain_howl(); o( Î².Publish("~/Sandbox") ); }

    ØŸ Run âš o( Î².Run("~/Sandbox") );

    ØŸ Test âš o( Î².Test("~/Sandbox") );

    // --------------------------------------------------------------

    ØŸ ProjectName âš o( Î².ProjectName("~/Sandbox"), "Sandbox");

    ØŸ ExeName âš o( Î².ExeName("~/Sandbox"), "sandbox");

    ØŸ Update(){
        "Sandbox/src".MkDir();
        "Sandbox/test".MkDir();
        //
        "Sandbox/src/A.howl".Write("â—‹ A{}");
        "Sandbox/src/X.cs".Write("â—‹ X{}");
        "Sandbox/test/TestA.howl".Write("â—‹ TestA{}");
        Î².Update("Sandbox");
        âˆƒ( "Sandbox/build/src/A.cs", "Sandbox/build/test/TestA.cs" );
        //
        "Sandbox/src/A.howl".JustDelete(dry: âœ—);
        "Sandbox/test/TestA.howl".JustDelete(dry: âœ—);
        Î².Update("Sandbox");
        // Stale C# output must not remain
        o( "Sandbox/build/src/A.cs".âˆƒ(), âœ—);
        o( "Sandbox/build/test/TestA.cs".âˆƒ(), âœ—);
        // Do not accidentally delete C# input, if any
        âˆƒ( "Sandbox/src/X.cs" );
        "Sandbox".RmDir(dry: âœ—);
    }

    ØŸ Update_noSrcDir(){
        "Sandbox".MkDir();
        o( Î².Update("Sandbox"), âœ—);
        "Sandbox".RmDir(dry: âœ—);
    }

    // ==============================================================

    â”ˆ MkMain_howl(){
        $"~/Sandbox/src/Main.howl"
        .Write("â€’ â—‹ Bar{ âˆ˜ â”ˆ Main(ã„¹[] args){} }", mkdir: âœ“);
    }

}}
