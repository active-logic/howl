âŠ System.IO; âŠ System.Linq;
âŠ InvOp = System.InvalidOperationException;
âŠ NUnit.Framework;
âŠ Active.Howl;

âŠ“ Unit{
â€’ â—‹ MapTest : TestBase{

    Map Ï‰;

    âœ Setup(){
        #if UNITY_EDITOR
        ImportConfig.Clear();
        #endif
        Ï‰ = Map.@default;
    }

    ØŸ FromRepArray(){
        Map x = âŒ¢ Rep[]{ ("a", "b"), ("c", "d") };
        o(x.rulesâ™, 2);
    }

    ØŸ Apply()
    â†’ o("â–· Act()" * Ï‰, "public action Act()");

    ØŸ EthiopicColonMappingTest(){
        Map x = âŒ¢ Rep[]{ ("á¥", "BAR") };
        o( "x á¥ y" * x, "x BAR y");
    }

    ØŸ MulOpMappingTest(){
        Map x = âŒ¢ Rep[]{ ("*", "MUL") };
        o( "x * y" * x, "x MUL y");
    }

    ØŸ Apply_withSelector()
    â†’ o("â€– x âˆˆ z Â¿ x > 0 á¥ foo" * Ï‰,
        "from x in z where x > 0 select foo");

    ØŸ Apply_withCompactModifiers_1()
    â†’ o("â€’âº" * Ï‰, "public override");

    ØŸ Apply_withCompactModifiers_2()
    â†’ o("â€’Ì¥âº" * Ï‰, "public static override");

    ØŸ Apply_quoted()
    â†’ o("\"(â•¯Â°â–¡Â°)â•¯\"" * Ï‰, "\"(â•¯Â°â–¡Â°)â•¯\"");

    ØŸ Apply_2 âŽš o("Badge(\"(â•¯Â°â–¡Â°)â•¯ âŒ’ $\"" * Ï‰,
                   "Badge(\"(â•¯Â°â–¡Â°)â•¯ âŒ’ $\"");

    ØŸ Consolidate âŽš o( Ï‰.Consolidate("â€’â—‹"), "â€’ â—‹" );

    // Does not acknowledge litterals, have to use segmented form
    ØŸ Consolidate_usesSegmentedForm âŽš
    o( Ï‰.Consolidate("A \"litt/eral\" string"),
       "A \"litt/eral\" string");

    ØŸ Consolidate_cmbVariants âŽš o( Ï‰.Consolidate("â€’Ì¥â—‹"), "â€’Ì¥ â—‹" );

    ØŸ Revert()
    â†’ o( "public action Act()" / Ï‰, "â–· Act()" );

    ØŸ Revert_bridging_token_honors_word_boundaries()
    â†’ o( "public Big.Values" / Ï‰, "â€’ Big.Values" );

    ØŸ NitPick âŽš o(">=" % Ï‰, "â‰¥");

    ØŸ NitPick_honors_word_boundaries(){
        o("[i].Value.Matches(key)" % Ï‰, "[i]á–¾.Matches(key)");
        o("[i].ValueMatches(key)" % Ï‰, "[i].ValueMatches(key)");
    }

    ØŸ Nits(){
        o( Ï‰.nits.âˆ‹(Ï‰.Rule(">=")) );
    }

    ØŸ Op_Soft(){
        âˆ™ Î› = !Ï‰;
        ðŸ¥(Î›);
    }

    ØŸ Revert_class_rule(){
         o( "class Foo" / Ï‰, "â—‹ Foo" );
    }

    // TODO this test causes a conflict that should not be
    // happening.
    // [Test] public void Revert_WithBridgedToken()
    // => o("public static void Act()" / Ï‰, "âƒ  â”ˆ Act()");

    #if UNITY_EDITOR
    ØŸ Revert_ConflictThrows(){
        â¤´(Config.Î¹.ignoreConflicts){
            âˆ™ ã„¸ = "ãƒ¡.Reach" / Ï‰;
        }â¤µ
            à² á´—à² <InvOp>( () â†’ { âˆ™ ã„¸ = "ãƒ¡.Reach" / Ï‰; } );
    }
    #endif

    // TODO when Howl imports this test file, escaped '"' causes
    // a conflict
    //[Test] public void Revert_NoConflictInEscapedBlocks(){
    //    var ã„¸ = "\"ãƒ¡.Reach\"" / Ï‰;
    //}

}}
