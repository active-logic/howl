âŠ System; âŠ System.IO; âŠ Ex = System.Exception;
âŠ System.Collections.Generic; âŠ System.Linq;

âŠ“ Active.Howl {
â€’Ì¥ â—‹ FileSystem{

    â€’Ì¥ ã„¹ FindInParent(ã„¹ root, ã„¹ pattern)
    â†’ DoFindInParent(âŒ¢ DirectoryInfo(root), pattern);

    â€’Ì¥ ã…‡ Match(ã„¹ pattern, ã„¹ root, ã…‡ files=âœ“, ã…‡ dirs=âœ—)
    â†’ FindAny(âŒ¢ DirectoryInfo(root), pattern, files, dirs);

    â€’Ì¥ ğ•ƒ<ã„¹> Paths(ã„¹ root, â‹¯ ã„¹[] patterns){
        âˆ™ ã„¸ = âŒ¢ ğ•ƒ<ã„¹>();
        âˆ€ (âˆ™ Ï€ âˆˆ patterns) Traverse(âŒ¢ DirectoryInfo(root), Ï€, ã„¸);
        â® ã„¸;
    }

    â€’Ì¥ ã„¹ ZeroOrOne(â¦¿ ã„¹ root, ã„¹ pattern){
        âˆ™ ã„¸ = Find(root, pattern);
        â¤´ (ã„¸â > 1) (â•¯Â°â–¡Â°)â•¯
                          âŒ¢ Ex($"There can be only one '{pattern}'");
        â® ã„¸â â˜° 0 ? âˆ… : ã„¸[0];
    }

    â€’Ì¥ ã„¹ Path(ã„¹ root, ã„¹ pattern){
        âˆ™ ã„¸ = Paths(root, pattern);
        â¤´(ã„¸â > 1) (â•¯Â°â–¡Â°)â•¯ âŒ¢ Ex($"Only zero or one '{pattern}'");
        â® ã„¸â â˜° 0 ? âˆ… : ã„¸[0];
    }

    âˆ˜ ğ•ƒ<ã„¹> Find(ã„¹ root, ã„¹ pattern) â†’ null;

    âˆ˜ â”ˆ Traverse(DirectoryInfo dir, ã„¹ pattern, ğ•ƒ<ã„¹> ã„¸){
        ã„¸.AddRange(â€– f âˆˆ dir.GetFiles(pattern) á¥ f.FullName.Nix());
        âˆ€ (âˆ™ x âˆˆ dir.GetDirectories()) Traverse(x, pattern, ã„¸);
    }

    âˆ˜ ã„¹ DoFindInParent(DirectoryInfo dir, ã„¹ pattern){
        âˆ™ files = dir.GetFiles(pattern);
        âˆ™ dirs = dir.GetDirectories(pattern);
        â¤´(filesâ™ > 0) â® files [0]ğŸ ;
        â¤´(dirsâ™  > 0) â® dirs  [0]ğŸ ;
        âˆ™ Ï€ = dir.Parent; â® Ï€ â‰  âˆ… ? DoFindInParent(Ï€, pattern) : âˆ…;
    }

    âˆ˜ ã…‡ FindAny(DirectoryInfo dir, ã„¹ pattern, ã…‡ files=âœ“, ã…‡ dirs=âœ—){
        â¤´( files âˆ§ dir.GetFiles       (pattern)â™ > 0 ) â® âœ“;
        â¤³( dirs  âˆ§ dir.GetDirectories (pattern)â™ > 0 ) â® âœ“;
        âˆ€ (âˆ™ x âˆˆ dir.GetDirectories()){
            â¤´ (FindAny(x, pattern, files, dirs)) â® âœ“;
        }
        â® âœ—;
    }

}}
